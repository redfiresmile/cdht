webpackJsonp([15],{264:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(491),n=a.n(s);for(var r in s)"default"!==r&&function(t){a.d(e,t,function(){return s[t]})}(r);var o=a(882),i=a.n(o),l=a(3),c=l(n.a,i.a,!1,null,null,null);c.options.__file="src/views/resources/attachments/list.vue",e.default=c.exports},491:function(t,e,a){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=a(26),r=s(n),o=a(880),i=s(o);e.default={components:{expandRow:i.default},data:function(){var t=this;return{tableStatus:{enable:[],use_status:[],type:[],storage_position:[]},loading:!1,search:{},feeds:{data:[],total:0,current_page:1,per_page:10},columns:[{title:">>",type:"expand",width:50,render:function(t,e){return t(i.default,{props:{row:e.row}})}},{title:"ID",key:"id",sortable:!0,width:100},{title:"附件名称",key:"original_name"},{title:"上传者",width:200,render:function(t,e){return t("div",e.row.user.name)}},{title:"使用状态",width:150,render:function(t,e){var a=e.row;return t("div",[t("Tag",{props:{type:"dot",color:"T"===a.use_status?"green":"default"}},"T"===a.use_status?"使用中":"未使用")])}},{title:"附件类型",key:"type",width:100},{title:"MIME 类型",key:"mime_type",width:100},{title:"存储位置",key:"storage_position",width:100},{title:"大小/kb",key:"size",sortable:!0,width:100},{title:"启用状态",key:"enable",render:function(e,a){return e("i-switch",{props:{slot:"open",type:"primary",value:"T"===a.row.enable},on:{"on-change":function(e){t.switchEnable(a.index)}}})}},{title:"创建时间",key:"created_at",sortable:!0},{title:"操作",render:function(e,a){var s=t;return e("div",[e("Poptip",{props:{confirm:!0,title:"您确定要删除「"+a.row.original_name+"」？",transfer:!0},on:{"on-ok":function(){"T"===a.row.enable?s.$Notice.warning({title:"出错了",desc:"启用状态的附件无法删除"}):s.deleteBtn(a.row.id,a.index)}}},[e("Button",{style:{margin:"0 5px"},props:{type:"error",size:"small",placement:"top"}},"删除")])])}}]}},created:function(){var t=this;t.getList(t.feeds.current_page),t.getTableStatus()},methods:{handleOnPageChange:function(t){this.getList(t)},getTableStatus:function(){var t=this;t.$util.ajax.get("/common_get_table_status/attachments").then(function(e){var a=e.data;t.tableStatus.enable=a.data.enable,t.tableStatus.use_status=a.data.use_status,t.tableStatus.type=a.data.type,t.tableStatus.storage_position=a.data.storage_position},function(t){})},getList:function(t){var e=this;e.loading=!0,e.feeds.current_page=t,e.$util.ajax.get("/admin/attachments?page="+t+"&per_page="+e.feeds.per_page+"&search_data="+(0,r.default)(e.search)).then(function(t){var a=t.data;e.feeds.data=a.data,e.feeds.total=a.meta.total,e.loading=!1},function(t){e.$Notice.warning({title:"出错了",desc:t.message}),e.loading=!1})},switchEnable:function(t){var e=this,a="T";"T"===e.feeds.data[t].enable&&(a="F"),e.$util.ajax.post("/common_switch_enable",{table:"attachments",id:e.feeds.data[t].id,value:a}).then(function(s){var n=s.data;e.feeds.data[t].enable=a,e.$Notice.success({title:n.message})},function(s){e.feeds.data[t].enable=a,e.$Notice.warning({title:"出错了",desc:s.message})})},deleteBtn:function(t,e){var a=this;a.$util.ajax.delete("/admin/attachments/"+t).then(function(t){var s=t.data;a.feeds.data.splice(e,1),a.$Notice.success({title:s.message})},function(t){a.$Notice.warning({title:"出错了",desc:t.message})})}}}},492:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{row:Object},data:function(){return{modalHeadImage:{show:!1}}},methods:{modalHeadImageShow:function(){this.modalHeadImage.show=!0}},computed:{getAttachmentUrl:function(){return this.row.domain+"/"+this.row.link_path+"/"+this.row.storage_name},attachmentIsImage:function(){return-1!==this.row.mime_type.indexOf("image")}}}},880:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(492),n=a.n(s);for(var r in s)"default"!==r&&function(t){a.d(e,t,function(){return s[t]})}(r);var o=a(881),i=a.n(o),l=a(3),c=l(n.a,i.a,!1,null,null,null);c.options.__file="src/views/resources/attachments/list-table-expand.vue",e.default=c.exports},881:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",{staticClass:"expand-row"},[a("span",{staticClass:"expand-key expand-title"},[t._v("绝对路径:  ")]),t._v(" "),a("span",{staticClass:"expand-value"},[t._v(t._s(t.row.storage_path)+"/"+t._s(t.row.storage_name))])]),t._v(" "),a("Row",{staticClass:"expand-row"},[t.attachmentIsImage?a("div",[a("img",{staticStyle:{"max-width":"100px","max-height":"100px"},attrs:{src:t.getAttachmentUrl,alt:""},on:{click:t.modalHeadImageShow}})]):a("div",[a("span",{staticClass:"expand-key expand-title"},[t._v("访问 url:  ")]),t._v(" "),a("span",{staticClass:"expand-value"},[t._v(t._s(t.row.domain)+"/"+t._s(t.row.link_path)+"/"+t._s(t.row.storage_name))])])]),t._v(" "),a("Modal",{model:{value:t.modalHeadImage.show,callback:function(e){t.$set(t.modalHeadImage,"show",e)},expression:"modalHeadImage.show"}},[a("p",{attrs:{slot:"header"},slot:"header"},[t._v("图片预览")]),t._v(" "),a("div",{staticClass:"text-center"},[t.modalHeadImage.show?a("img",{staticClass:"center-align",attrs:{src:t.getAttachmentUrl,alt:""}}):t._e()]),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"})])],1)},n=[];s._withStripped=!0;var r={render:s,staticRenderFns:n};e.default=r},882:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"resources-attachments-list"}},[a("Row",{staticClass:"code-row-bg",attrs:{type:"flex",justify:"end",gutter:16}},[a("Col",{attrs:{span:"2"}},[a("Select",{attrs:{placeholder:"请选择使用状态"},model:{value:t.search.use_status,callback:function(e){t.$set(t.search,"use_status",e)},expression:"search.use_status"}},[a("Option",{key:"",attrs:{value:""}},[t._v("全部")]),t._v(" "),t._l(t.tableStatus.use_status,function(e,s){return a("Option",{key:s,attrs:{value:s}},[t._v(t._s(e))])})],2)],1),t._v(" "),a("Col",{attrs:{span:"2"}},[a("Select",{attrs:{placeholder:"请选择状态"},model:{value:t.search.enable,callback:function(e){t.$set(t.search,"enable",e)},expression:"search.enable"}},[a("Option",{key:"",attrs:{value:""}},[t._v("全部")]),t._v(" "),t._l(t.tableStatus.enable,function(e,s){return a("Option",{key:s,attrs:{value:s}},[t._v(t._s(e))])})],2)],1),t._v(" "),a("Col",{attrs:{span:"2"}},[a("Select",{attrs:{placeholder:"请选择附件类型"},model:{value:t.search.type,callback:function(e){t.$set(t.search,"type",e)},expression:"search.type"}},[a("Option",{key:"",attrs:{value:""}},[t._v("全部")]),t._v(" "),t._l(t.tableStatus.type,function(e,s){return a("Option",{key:s,attrs:{value:s}},[t._v(t._s(e))])})],2)],1),t._v(" "),a("Col",{attrs:{span:"2"}},[a("Select",{attrs:{placeholder:"请选择存储位置"},model:{value:t.search.storage_position,callback:function(e){t.$set(t.search,"storage_position",e)},expression:"search.storage_position"}},[a("Option",{key:"",attrs:{value:""}},[t._v("全部")]),t._v(" "),t._l(t.tableStatus.storage_position,function(e,s){return a("Option",{key:s,attrs:{value:s}},[t._v(t._s(e)+"\n                ")])})],2)],1),t._v(" "),a("Col",{attrs:{span:"2"}},[a("Button",{attrs:{type:"primary",icon:"ios-search"},on:{click:function(e){t.getList(t.feeds.current_page)}}},[t._v("Search")])],1)],1),t._v(" "),a("br"),t._v(" "),a("Row",[a("Table",{attrs:{border:"",columns:t.columns,data:t.feeds.data,loading:t.loading}}),t._v(" "),a("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[a("div",{staticStyle:{float:"right"}},[a("Page",{staticClass:"paging",attrs:{total:t.feeds.total,current:t.feeds.current_page,"page-size":t.feeds.per_page,"show-elevator":"","show-total":""},on:{"on-change":t.handleOnPageChange}})],1)])],1)],1)},n=[];s._withStripped=!0;var r={render:s,staticRenderFns:n};e.default=r}});